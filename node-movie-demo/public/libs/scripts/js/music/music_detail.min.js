"use strict";$.support.cors=!0,$(function(){function t(t){return t<10?"0"+t:""+t}function a(a){return t(a.getMonth()+1)+"-"+t(a.getDate())+" "+t(a.getHours())+":"+t(a.getMinutes())}var e=15*Math.ceil($(".rating-num strong").html()-10);$(".star").css("background-position-y",e),$("#mediaList").on("click",".comment",function(){var t=$(this),a=t.data("tid"),e=t.data("cid");$(t).parents(".media-body").attr("id","mediaBody"),$("#toId").length>0?$("#toId").val(a):$("<input>").attr({type:"hidden",id:"toId",name:"comment[tid]",value:a}).appendTo("#commentForm"),$("#commentId").length>0?$("#commentId").val(e):$("<input>").attr({type:"hidden",id:"commentId",name:"comment[cid]",value:e}).appendTo("#commentForm")}),$("#comments button").on("click",function(t){t.preventDefault(),$.ajax({url:"/admin/music/musicComment",type:"POST",data:{"comment[music]":$('#comments input[name="comment[music]"]').val(),"comment[from]":$('#comments input[name="comment[from]"]').val(),"comment[content]":$("#comments textarea").val(),"comment[tid]":$("#toId").val(),"comment[cid]":$("#commentId").val()}}).done(function(t){var e=t.data||{};if(e.reply.length){var i=e.reply.length;$("#mediaBody").append('<div class="media"><div class="media-left"><img src="/libs/images/user/headImg.png" style="width: 30px; height: 30px;"/></div><div class="media-body"><h4  class="media-heading">'+e.reply[i-1].from.name+"<span>&nbsp;回复&nbsp;</span>"+e.reply[i-1].to.name+"</h4><p>"+e.reply[i-1].content+'</p><span class="createAt">'+a(new Date)+'</span>&nbsp;&nbsp;&nbsp;&nbsp;<a class="comment" href="#comments" data-cid='+e._id+" data-tid="+e.reply[i-1].to._id+'> 回复</a>&nbsp;|&nbsp;<a class="comment-del" href="javascript:;" data-cid='+e._id+" data-did="+e.reply[i-1]._id+">删除</a></div></div>")}else $("#mediaList").append('<li class="media"><div class="media-left"><img src="/libs/images/user/headImg.png" style="width: 40px; height: 40px;" /></div><div class="media-body"><h4 class="media-heading">'+e.from.name+"</h4><p>"+e.content+'</p><span class="createAt">'+a(new Date)+'</span>&nbsp;&nbsp;&nbsp;&nbsp;<a class="comment" href="#comments" data-cid='+e._id+" data-tid="+e.from._id+'> 回复</a>&nbsp;|&nbsp;<a class="comment-del" href="javascript:;" data-cid='+e._id+">删除</a></div><hr></li>");$("#comments textarea").val(""),$("#mediaBody").removeAttr("id"),$("#commentForm input:gt(1)").remove()})}),$("#mediaList").on("click",".comment-del",function(t){var a=$(this).parent(".media-body"),e=$(t.target).data("cid"),i=$(t.target).data("did");$.ajax({url:"/music/:id?cid="+e+"&did="+i,type:"DELETE"}).done(function(t){1===t.success&&a.parent().remove()})}),$("audio").on("play",function(t){var a=$(t.target),e=a.data("id"),i=$("#lrc"),n="",s=new Date;$.ajax({url:"/musicPaly?id="+e,type:"get",dataType:"json",cache:!0,crossDomain:!0,success:function(t){var t=JSON.parse(t);n+='<div class="info">',$(t).find("TITLE").length>0&&(n+='<p class="music-title lyrics-title">歌曲：'+$(t).find("TITLE").text()+"</p>"),$(t).find("ALBUM").length>0&&(n+='<p class="album lyrics-title">专辑：'+$(t).find("ALBUM").text()+"</p>"),$(t).find("ARTIST").length>0&&(n+='<p class="artist lyrics-title">演唱：'+$(t).find("ARTIST").text()+"</p>"),n+="</div>",n+='<div class="lyrics-container">',n+='<div class="lyrics-container2">',$(t).find("LRC").each(function(){n+='<p class="lyrics" tag="'+$(this).attr("TAG")+'">'+$(this).text()+"</p>"}),n+="</div></div>",i.html(n)}});setInterval(function(){var t=new Date,a=t-s;i.find(".lyrics").length&&i.find(".lyrics").each(function(){var t=a-$(this).attr("tag");t<13&&t>0&&(i.find(".lyrics").removeClass("activated"),$(this).addClass("activated"),$(this).prevAll(".lyrics").length>3&&$(".lyrics-container2").animate({top:"-=30px"}))})},10)})});