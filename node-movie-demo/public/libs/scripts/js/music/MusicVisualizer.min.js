function MusicVisualizer(i){this.source=null,this.count=0,this.analyser=MusicVisualizer.ac.createAnalyser(),this.size=i.size,this.analyser.fftSize=2*this.size,this.gainNode=MusicVisualizer.ac[MusicVisualizer.ac.createGain?"createGain":"createGainNode"](),this.gainNode.connect(MusicVisualizer.ac.destination),this.analyser.connect(this.gainNode),this.xhr=new XMLHttpRequest,this.visualizer=i.visualizer,this.visualize()}MusicVisualizer.ac=new(window.AudioContext||window.webkitAudioContext),MusicVisualizer.prototype.load=function(i,t){this.xhr.abort(),this.xhr.open("GET",i),this.xhr.responseType="arraybuffer";var e=this;this.xhr.onload=function(){t(e.xhr.response)},this.xhr.send()},MusicVisualizer.prototype.decode=function(i,t){MusicVisualizer.ac.decodeAudioData(i,function(i){t(i)},function(i){console.log(i)})},MusicVisualizer.prototype.play=function(i){var t=++this.count;this.source&&this.stop();var e=this;this.load(i,function(i){t==e.count&&e.decode(i,function(i){if(t==e.count){var s=MusicVisualizer.ac.createBufferSource();s.connect(e.analyser),s.buffer=i,s[s.start?"start":"noteOn"](0),e.source=s}})})},MusicVisualizer.prototype.stop=function(){this.source[this.source.stop?"stop":"noteOff"](0)},MusicVisualizer.prototype.changeVolume=function(i){this.gainNode.gain.value=i*i},MusicVisualizer.prototype.visualize=function(){function i(){e.analyser.getByteFrequencyData(t),console.log(t),e.visualizer(t),requestAnimationFrame(i)}var t=new Uint8Array(this.analyser.frequencyBinCount);requestAnimationFrame=window.requestAnimationFrame||window.webkitrequestAnimationFrame||window.mozrequestAnimationFrame;var e=this;requestAnimationFrame(i)},MusicVisualizer.prototype.addinit=function(i){this.initCallback=i},MusicVisualizer.prototype.start=function(i){this.source&&this.source[this.source.start?"start":"noteOn"](0)};